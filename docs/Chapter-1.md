# Chapter 1: AWS EC2 Sample Deployment

## Introduction
This document provides detailed, step-by-step instructions on creating a new AWS EC2 instance and deploying a provided Symfony2 application on it using LAMP (Linux, Apache, MySQL, PHP) stack. The application also uses a separate Redis database for certain parts of it, but the connection to Redis is not included in these instructions. These instructions are detailed for use with Mac OS; however, once logged onto the virtual machine provided by your EC2, the instructions are universal. The provided application is a website call “Spoutlet” and it will be cloned from an online github repository.

## Sign up for AWS Free Tier 
1. Sign up for Free Cloud Services – AWS Free Tier https://aws.amazon.com/free/
1. “AWS Free Tier includes offers that expire 12 months following sign up and others that never expire.”

## Create AWS EC2 instance
1. Log into AWS console and select “Services” > “EC2”
1. Click on “Instances”

## Launch Instance
1. Click on “Launch Instance”
1. Select “Ubuntu Server 16.04...”
1. Select the t2.medium size instance - VERY IMPORTANT
   1. click Next until you reach “Step 6: Configure Security Groups”
   1. Or Click on the “Step 6: Configure Security Groups” tab, located along the top of the screen.
1. Change “security group name” to “spoutlet - sample deployment”
1. Click “Add Rule”
   1. Add “Custom TCP Rule” with Port Range = 8000
   1. Change “Source” drop down menu to “Anywhere”
   1. Add “Custom TCP Rule” with Port Range = 0
   1. Change “Source” drop down menu to “Anywhere”
1. Click “Add Rule”
   1. Add “HTTP”
   1. Change “Source” drop down menu to “Anywhere”
1. Click “Review and Launch”, then review settings and click “Launch”
1. A pop up window will appear asking about a security key
   1. Select “Create a new key pair” from the first drop down box
   1. Enter “spoutlet_sampleEC2” for the key pair name, then “Download Key Pair”
   ***IMPORTANT*: after downloading the key, place it in a safe and accessible place (perhaps create a backup copy and store it in the cloud); if lost, your key cannot be replaced, as AWS does not store your key after its creation
1. After storing your key in a safe and secure location, click “Launch Instances”



...

https://docs.google.com/document/d/1dKerau5K38A8iIsPBdc2c8Eg9uXMaTRLIUDICKKuOSY/edit - automatic!
[DevOps](https://docs.google.com/document/d/1dKerau5K38A8iIsPBdc2c8Eg9uXMaTRLIUDICKKuOSY/edit)


## Connect* to Instance from AWS console
1. After launching instance, return to running instances by clicking on “Services” > “EC2”
1. Click on “Instances”
   1. You should see your deployed instance with “Initializing” status under “Status Checks”
   1. Rename the instance to “Spoutlet Sample”
1. Select your instance and click “Connect”, this should launch a pop up window with instructions

## Connect to Instance from Terminal
1. With Terminal  / MacOS, From Termnal: 
   1. chmod 400 spoutlet.publickey
   1. ssh -i "spoutlet.pem" ubuntu@ec2-54-193-37-203.us-west-1.compute.amazonaws.com
1. With PuTTY / Windows 
   1. Connecting to Your Linux Instance from Windows Using PuTTY https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/putty.html 
   1. Convert the .pem file to a .ppk file
   1. PuTTY does not natively support the private key format (.pem) generated by Amazon EC2. PuTTY has a tool named PuTTYgen, which can convert keys to the required PuTTY format (.ppk). You must convert your private key into this format (.ppk) before attempting to connect to your instance using PuTTY.
   1. To convert your key from Public to Private (ppk to pem)
      1. Start PuTTYgen (for example, from the Start menu, choose All Programs > PuTTY > PuTTYgen).            
      1. Under Type of key to generate, choose RSA.    
      1. If you're using an older version of PuTTYgen, choose SSH-2 RSA.                    
         1. Choose Load. By default, PuTTYgen displays only files with the extension .ppk. To locate your .pem file, select the option to display files of all types. 
         1. Select your .pem file for the key pair that you specified when you launch your instance, and then choose                             Open. Choose OK to dismiss the confirmation dialog box.                    
         1. Choose Save private key to save the key in the format that PuTTY can use. PuTTYgen displays a warning about saving the key without a passphrase. Choose Yes.
         1. Note
            1. A passphrase on a private key is an extra layer of protection, so even if your private key is discovered, it can't be used without the passphrase. The downside to using a passphrase is that it makes automation harder because human intervention is needed to log on to an instance, or copy files to an instance                    
         1. Specify the same name for the key that you used for the key pair (for example, my-key-pair). PuTTY automatically adds the .ppk file extension. Your private key is now in the correct format for use with PuTTY. You can now connect to your instance using PuTTY's SSH client.
            1. Open a terminal window and navigate into the directory where you placed your “spoutlet_sampleEC2.pem” key (downloaded in step 2h)
            1. Add privacy restrictions to your key by typing “chmod 400 spoutlet_sampleEC2.pem” on command line and hit enter
            1. Launch virtual machine via ssh by typing “ssh -i "spoutlet_sampleEC2.pem" ubuntu@*your-instance*.compute.amazonaws.com” on command line and hit enter 
You can copy the above line under “example” from the “Connect to your instance” pop up window on your aws console and paste it in your terminal
            1. You will be asked if you are sure you want to continue, type “yes” and hit enter
            1. You should now be connected to your EC2 instance via a Virtual Machine in your terminal window (your username in the terminal window should now be “ubuntu@ip-*your-ip*”)



